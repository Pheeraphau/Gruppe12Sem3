@model WebApplication1.Models.PositionModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Rapporter Feil</h2>

<div id="map" style="height: 400px; margin-top: 20px;"></div>

@section Scripts {
    <script>
        // Initialize the map
        var map = L.map('map').setView([60.14, 10.25], 9);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Handle map click event
        map.on('click', function (e) {
            // Get clicked position
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;

            // Show a popup with a form to enter description
            var popupContent = `
                        <form id="errorForm">
                            <label for="description">Beskrivelse:</label><br>
                            <textarea id="description" name="description" rows="3" cols="30"></textarea><br>
                            <button type="button" onclick="submitError(${lat}, ${lng})">Send inn</button>
                        </form>
                    `;
            L.popup()
                .setLatLng(e.latlng)
                .setContent(popupContent)
                .openOn(map);
        });

        // Function to submit error
        function submitError(lat, lng) {
            var description = document.getElementById("description").value;

            // Send data to the server using AJAX
            fetch('/Home/SubmitError', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ latitude: lat, longitude: lng, description: description })
            })
                .then(response => response.json())
                .then(data => {
                    alert("Feil rapportert: " + data.message);
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }
    </script>
}
