@model IEnumerable<WebApplication1.Models.BrukerInnmelding>

@{
    ViewData["Title"] = "Saksbehandler Oversikt";
}

<div class="container mt-5">
    <div class="card p-4" style="background-color: rgba(255, 255, 255, 0.9); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); border-radius: 8px;">
        <h2 class="text-center">Aktive innmeldinger</h2>

        <!-- Search Bar Form -->
        <form asp-action="SaksBehandlerOversikt" method="get">
            <div class="input-group mb-3">
                <input type="text" name="searchTerm" class="form-control" placeholder="Søk etter navn, ID eller beskrivelse"
                       value="@ViewData["SearchTerm"]" />
                <button type="submit" class="btn btn-primary">Søk</button>
            </div>
        </form>

        <!-- Table displaying results -->
        <table class="table mt-4">
            <thead>
                <tr class="text-center">
                    <th>
                        <div class="btn btn-success rounded-pill px-3">ID</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Kundetelefon</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Kundenavn</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Registreringsdato</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Beskrivelse</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Status</div>
                    </th>
                    <th>
                        <div class="btn btn-success rounded-pill px-3">Inspiser</div>
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var BrukerInnmelding in Model)
                {
                    <tr class="text-center">
                        <td>@BrukerInnmelding.Id</td>
                        <td>23985495</td>
                        <td>Kristian</td>
                        <td>@BrukerInnmelding.Registreringsdato.ToString("yyyy-MM-dd")</td>
                        <td>@BrukerInnmelding.Beskrivelse</td>
                        <td>@BrukerInnmelding.Status</td>
                        <td>
                            <a href="@Url.Action("Edit", "Home", new { id = BrukerInnmelding.Id })" class="text-primary">Rediger</a>
                            <a href="@Url.Action("Details", "Home", new { id = BrukerInnmelding.Id })" class="text-primary">Detaljer</a>
                            <a href="#" class="delete-btn text-danger" data-id="@BrukerInnmelding.Id" data-source="SaksBehandlerOversikt">Delete</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const deleteButtons = document.querySelectorAll('.delete-btn');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function (event) {
                const itemId = this.getAttribute('data-id');
                const source = this.getAttribute('data-source');

                // Show confirmation dialog
                const isConfirmed = confirm('Are you sure you want to delete this Innmelding?');

                if (isConfirmed) {
                    // If confirmed, navigate to the delete action with the source parameter
                    window.location.href = '@Url.Action("Delete", "Home", new { id = "__id__", source = "__source__" })'
                        .replace('__id__', itemId)
                        .replace('__source__', source);
                }
            });
        });
    });
</script>
